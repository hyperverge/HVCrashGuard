name: Release HVCrashGuard            # â† shown in the â€œActionsâ€ tab

on:
  push:
    branches: [ main ]                # auto-publish when main is updated
  workflow_dispatch:                  # allow manual trigger
    inputs:
      version:
        description: "SemVer to release (e.g. 1.2.3)"
        required: true
        type: string                  # â†’  github.event.inputs.version

jobs:
  release:
    runs-on: macos-14                 # Xcode 15.2 pre-installed

    steps:
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ checkout repo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - uses: actions/checkout@v4

    # decide which version to publish (manual input wins, fallback = secret)
    - id: vars
      run: |
        VERSION="${{ github.event.inputs.version || secrets.HVCRASHGUARD_VERSION }}"
        echo "version=$VERSION" >> "$GITHUB_OUTPUT"

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1. lint podspec â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: CocoaPods lint
      env:
        VERSION: ${{ steps.vars.outputs.version }}
      run: pod spec lint HVCrashGuard.podspec --allow-warnings --verbose

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2. create & push git tag (if new) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Create and push tag
      env:
        VERSION: ${{ steps.vars.outputs.version }}
      run: |
        if git rev-parse "v$VERSION" >/dev/null 2>&1; then
          echo "Tag v$VERSION already exists â€“ skipping"; exit 0; fi
        git tag "v$VERSION"
        git push origin "v$VERSION"

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3. pod trunk push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Publish to CocoaPods trunk
      env:
        COCOAPODS_TRUNK_TOKEN: ${{ secrets.COCOAPODS_TRUNK_TOKEN }}
      run: pod trunk push HVCrashGuard.podspec --allow-warnings

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4. log nice âœ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Log success
      run: echo "ðŸŽ‰ HVCrashGuard ${{ steps.vars.outputs.version }} released!"

